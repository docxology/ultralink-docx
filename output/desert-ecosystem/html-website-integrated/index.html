
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Desert Ecosystem</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="styles/academic.css">
  
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    :root {
      
      
    }
    
    body {
      background: var(--bg-color);
      color: var(--text-color);
      
    }
    
    header, footer {
      background: rgba(32, 33, 36, 0.8);
      
    }

    @media (max-width: 768px) {
      nav {
        flex-direction: column;
      }
      .visualization-controls {
        flex-direction: column;
      }
      .entity-types ul {
        padding-left: 1rem;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>Desert Ecosystem</h1>
    <p>Interactive visualization of desert ecosystem relationships</p>
    <nav>
      <a href="index.html" class="active">Home</a>
      <a href="entities.html">All Entities</a>
      <a href="relationships.html">All Relationships</a>
    </nav>
  </header>
  
  <main>
    <section class="summary">
      <h2>Knowledge Base Summary</h2>
      <p>System: Desert Ecosystem</p>
      <p>Total Entities: 3</p>
      <p>Total Relationships: 2</p>
      <p>Interactive visualization of research team relationships</p>
    </section>
    
    <section class="visualization-controls">
      <div class="filters">
        <div id="type-filters">
          <h3>Filter by Type</h3>
          <!-- Type filters will be generated by JavaScript -->
        </div>
        <button class="btn" id="clear-filters">Clear Filters</button>
      </div>
      <div class="zoom-controls">
        <button class="zoom-btn" id="zoom-in">+</button>
        <button class="zoom-btn" id="zoom-reset">⟳</button>
        <button class="zoom-btn" id="zoom-out">−</button>
      </div>
    </section>
    
    <section class="visualization">
      <div id="graph"></div>
    </section>
    
    <section class="entity-types">
      <h2>Entity Types</h2>
      <ul>
            <li>
              <strong>organism</strong>: 2 entities
              <ul>
                <li>
                  <a href="saguaro.html">Saguaro Cactus</a>
                  <a href="javascript:void(0)" onclick="selectEntityById('saguaro')" class="visualize-link">(visualize)</a>
                </li>
                <li>
                  <a href="kangaroo-rat.html">Kangaroo Rat</a>
                  <a href="javascript:void(0)" onclick="selectEntityById('kangaroo-rat')" class="visualize-link">(visualize)</a>
                </li>
              </ul>
            </li>
            <li>
              <strong>environmental_factor</strong>: 1 entities
              <ul>
                <li>
                  <a href="aridity.html">Aridity</a>
                  <a href="javascript:void(0)" onclick="selectEntityById('aridity')" class="visualize-link">(visualize)</a>
                </li>
              </ul>
            </li>
          </ul>
        </section>
  </main>
  
  <footer>
    <p>Generated with UltraLink</p>
  </footer>

  <script>
    // Graph visualization
    const width = 800;
    const height = 600;
    const svg = d3.select('#graph')
      .append('svg')
      .attr('width', '100%')
      .attr('height', '100%')
      .attr('viewBox', [0, 0, width, height])
      .attr('preserveAspectRatio', 'xMidYMid meet');
    
    // Create graph data
    const nodes = [
      
        {
          id: "saguaro",
          type: "organism",
          attributes: {"name":"Saguaro Cactus","scientificName":"Carnegiea gigantea","type":"plant","height":"15-50 feet","lifespan":"150-200 years"}
        },
        {
          id: "kangaroo-rat",
          type: "organism",
          attributes: {"name":"Kangaroo Rat","scientificName":"Dipodomys","type":"mammal","weight":"100-150g","nocturnal":true}
        },
        {
          id: "aridity",
          type: "environmental_factor",
          attributes: {"name":"Aridity","description":"Extremely dry conditions with minimal rainfall","annualRainfall":"3-15 inches"}
        }
    ];
    
    const links = [
      
        {
          source: "saguaro",
          target: "aridity",
          type: "adapts_to",
          attributes: {"mechanism":"Water storage in stem","efficiency":0.95}
        },
        {
          source: "kangaroo-rat",
          target: "aridity",
          type: "adapts_to",
          attributes: {"mechanism":"Metabolic water production","efficiency":0.88}
        }
    ];
    
    // Create force simulation
    const simulation = d3.forceSimulation(nodes)
      .force('link', d3.forceLink(links).id(d => d.id))
      .force('charge', d3.forceManyBody().strength(-100))
      .force('center', d3.forceCenter(width / 2, height / 2));
    
    // Create links
    const link = svg.append('g')
      .selectAll('line')
      .data(links)
      .join('line')
      .attr('stroke', '#999')
      .attr('stroke-opacity', 0.6)
      .attr('stroke-width', 1.5);
    
    // Create nodes
    const node = svg.append('g')
      .selectAll('circle')
      .data(nodes)
      .join('circle')
      .attr('r', 5)
      .attr('fill', d => getColorByType(d.type))
      .call(drag(simulation));
    
    // Add labels
    const label = svg.append('g')
      .selectAll('text')
      .data(nodes)
      .join('text')
      .text(d => d.attributes.name || d.attributes.title || d.id)
      .attr('font-size', 10)
      .attr('dx', 8)
      .attr('dy', 3);
    
    // Update positions on simulation tick
    simulation.on('tick', () => {
      link
        .attr('x1', d => d.source.x)
        .attr('y1', d => d.source.y)
        .attr('x2', d => d.target.x)
        .attr('y2', d => d.target.y);
      
      node
        .attr('cx', d => d.x)
        .attr('cy', d => d.y);
      
      label
        .attr('x', d => d.x)
        .attr('y', d => d.y);
    });
    
    // Implement zoom functionality
    const zoom = d3.zoom()
      .scaleExtent([0.1, 4])
      .on('zoom', (event) => {
        svg.selectAll('g').attr('transform', event.transform);
      });
    
    svg.call(zoom);
    
    // Zoom controls
    const zoomInBtn = document.getElementById('zoom-in');
    const zoomOutBtn = document.getElementById('zoom-out');
    const zoomResetBtn = document.getElementById('zoom-reset');
    
    zoomInBtn.addEventListener('click', () => {
      svg.transition().duration(300).call(zoom.scaleBy, 1.5);
    });
    
    zoomOutBtn.addEventListener('click', () => {
      svg.transition().duration(300).call(zoom.scaleBy, 0.75);
    });
    
    zoomResetBtn.addEventListener('click', () => {
      svg.transition().duration(300).call(zoom.transform, d3.zoomIdentity);
    });
    
    // Implement drag functionality
    function drag(simulation) {
      function dragstarted(event) {
        if (!event.active) simulation.alphaTarget(0.3).restart();
        event.subject.fx = event.subject.x;
        event.subject.fy = event.subject.y;
      }
      
      function dragged(event) {
        event.subject.fx = event.x;
        event.subject.fy = event.y;
      }
      
      function dragended(event) {
        if (!event.active) simulation.alphaTarget(0);
        event.subject.fx = null;
        event.subject.fy = null;
      }
      
      return d3.drag()
        .on('start', dragstarted)
        .on('drag', dragged)
        .on('end', dragended);
    }
    
    // Get color by entity type
    function getColorByType(type) {
      const colors = {
        person: '#4285F4',
        organization: '#EA4335',
        project: '#FBBC05',
        publication: '#34A853',
        event: '#8F44AD',
        location: '#16A085',
        concept: '#E67E22',
        resource: '#1ABC9C'
      };
      
      return colors[type] || '#999';
    }
    
    // Generate type filters
    const typeFilters = document.getElementById('type-filters');
    const types = [...new Set(nodes.map(node => node.type))];
    
    types.forEach(type => {
      const label = document.createElement('label');
      const input = document.createElement('input');
      input.type = 'checkbox';
      input.value = type;
      input.checked = true;
      input.dataset.type = type;
      
      label.appendChild(input);
      label.appendChild(document.createTextNode(type));
      typeFilters.appendChild(label);
      
      input.addEventListener('change', updateFilters);
    });
    
    // Clear filters button
    const clearFiltersBtn = document.getElementById('clear-filters');
    clearFiltersBtn.addEventListener('click', () => {
      Array.from(typeFilters.querySelectorAll('input')).forEach(input => {
        input.checked = true;
      });
      updateFilters();
    });
    
    // Update filters
    function updateFilters() {
      const selectedTypes = Array.from(typeFilters.querySelectorAll('input:checked'))
        .map(input => input.value);
      
      node.attr('visibility', d => selectedTypes.includes(d.type) ? 'visible' : 'hidden');
      label.attr('visibility', d => selectedTypes.includes(d.type) ? 'visible' : 'hidden');
      
      link.attr('visibility', d => {
        const sourceNode = nodes.find(node => node.id === d.source.id);
        const targetNode = nodes.find(node => node.id === d.target.id);
        return selectedTypes.includes(sourceNode.type) && selectedTypes.includes(targetNode.type) ? 'visible' : 'hidden';
      });
    }
    
    // Function to select entity by ID
    window.selectEntityById = (id) => {
      const selectedNode = nodes.find(node => node.id === id);
      if (!selectedNode) return;
      
      // Highlight the selected node
      node.attr('stroke', d => d.id === id ? '#000' : null)
          .attr('stroke-width', d => d.id === id ? 2 : null);
      
      // Center and zoom to the selected node
      const scale = 2;
      const x = width / 2 - scale * selectedNode.x;
      const y = height / 2 - scale * selectedNode.y;
      
      svg.transition().duration(500)
        .call(zoom.transform, d3.zoomIdentity.translate(x, y).scale(scale));
    };
    
    // Helper function to get entity name
    function getEntityName(entity) {
      const name = entity.attributes.name || entity.attributes.title || entity.id;
      return name;
    }
  </script>
</body>
</html>