<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NeurofeedbackResearch Knowledge Graph</title>
    <meta name="description" content="Interactive exploration of the NeurofeedbackResearch knowledge graph">
    <link rel="stylesheet" href="styles/default.css">
    <style>
    /* Default Theme CSS */
:root {
  --bg-color: #ffffff;
  --text-color: #333333;
  --link-color: #0066cc;
  --accent-color: #4a9eff;
  --border-color: #dddddd;
  --node-hover: #ff6600;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
  line-height: 1.6;
  color: var(--text-color);
  background-color: var(--bg-color);
  margin: 0;
  padding: 0;
}

/* Layout */
header {
  padding: 1.5rem;
  background: rgba(255, 255, 255, 0.9);
  border-bottom: 1px solid var(--border-color);
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

main {
  display: flex;
  height: calc(100vh - 180px);
}

#graph {
  flex: 1;
  background: rgba(249, 250, 251, 0.8);
  border-right: 1px solid var(--border-color);
}

.details-panel {
  width: 300px;
  padding: 1rem;
  overflow-y: auto;
}

/* Entity styles */
.entity-page {
  max-width: 1200px;
  margin: 0 auto;
  padding: 2rem;
}

.entity-section {
  margin-bottom: 2rem;
  padding: 1.5rem;
  background: rgba(255, 255, 255, 0.05);
  border-radius: 4px;
  border: 1px solid var(--border-color);
}

.attribute-table {
  width: 100%;
  border-collapse: collapse;
}

.attribute-table th, .attribute-table td {
  padding: 0.75rem;
  text-align: left;
  border-bottom: 1px solid var(--border-color);
}

.attribute-table tr:nth-child(even) {
  background: rgba(255, 255, 255, 0.05);
}

.relationship-item {
  margin-bottom: 1rem;
  padding: 0.75rem;
  border-radius: 4px;
  border: 1px solid var(--border-color);
}

.relationship-attributes {
  margin-top: 0.5rem;
  padding-top: 0.5rem;
  border-top: 1px dashed var(--border-color);
  font-size: 0.9rem;
}

/* Controls */
.controls {
  display: flex;
  justify-content: space-between;
  margin-bottom: 1rem;
}

.filters {
  display: flex;
  gap: 1rem;
}

.legend-items {
  display: flex;
  flex-wrap: wrap;
  gap: 0.5rem;
}

.legend-item {
  display: flex;
  align-items: center;
  gap: 0.25rem;
}

.legend-color {
  width: 12px;
  height: 12px;
  border-radius: 50%;
}

.zoom-controls {
  position: absolute;
  right: 1rem;
  top: 5rem;
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.zoom-btn {
  width: 30px;
  height: 30px;
  border-radius: 50%;
  border: 1px solid var(--border-color);
  background: white;
  cursor: pointer;
}

/* Media queries for responsiveness */
@media (max-width: 768px) {
  main {
    flex-direction: column;
    height: auto;
  }
  
  #graph {
    height: 50vh;
    border-right: none;
    border-bottom: 1px solid var(--border-color);
  }
  
  .details-panel {
    width: 100%;
  }
  
  .zoom-controls {
    bottom: 50vh;
  }
  
  .controls {
    flex-direction: column;
  }
  
  .filters {
    flex-direction: column;
    width: 100%;
  }
}
    </style>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <!-- const name = entity.attributes.name || entity.attributes.title || entity.id; -->
</head>
<body class="theme-default">
    <header>
        <h1>NeurofeedbackResearch Knowledge Graph</h1>
        <p>Interactive exploration of the NeurofeedbackResearch knowledge graph</p>
        <div class="controls">
            <div class="legend"></div>
            <div class="filters">
                <label>Filter by type:
                    <select id="typeFilter">
                        <option value="all">All</option>
                    </select>
                </label>
                <label>Search:
                    <input type="text" id="searchInput" placeholder="Search nodes...">
                </label>
                <button class="btn" id="clear-filters">Clear Filters</button>
            </div>
        </div>
        <div class="zoom-controls">
            <button class="zoom-btn" id="zoom-in">+</button>
            <button class="zoom-btn" id="zoom-reset">⟳</button>
            <button class="zoom-btn" id="zoom-out">−</button>
        </div>
    </header>
    <main>
        <div id="graph"></div>
        <div id="details" class="details-panel">
            <h2>Details</h2>
            <div id="nodeDetails">
                <p>Click a node to see details</p>
            </div>
        </div>
    </main>
    <script>
        const data = {
            entities: [{"id":"eeg-neurofeedback","type":"modality","attributes":{"name":"EEG Neurofeedback","description":"Feedback based on electroencephalography (EEG) signals, measuring electrical activity of the brain.","discovery_year":1968,"signal_type":"electrical","measurement_location":"scalp","temporal_resolution":"milliseconds","spatial_resolution":"centimeters","cost_effectiveness":"high","portability":"medium to high"}},{"id":"fmri-neurofeedback","type":"modality","attributes":{"name":"fMRI Neurofeedback","description":"Feedback based on functional magnetic resonance imaging, measuring blood oxygen level-dependent (BOLD) response.","discovery_year":1995,"signal_type":"hemodynamic","measurement_location":"whole brain","temporal_resolution":"seconds","spatial_resolution":"millimeters","cost_effectiveness":"low","portability":"low"}},{"id":"fnirs-neurofeedback","type":"modality","attributes":{"name":"fNIRS Neurofeedback","description":"Feedback based on functional near-infrared spectroscopy, measuring hemodynamic responses in the cortex.","discovery_year":2004,"signal_type":"hemodynamic","measurement_location":"cortical surface","temporal_resolution":"seconds","spatial_resolution":"centimeters","cost_effectiveness":"medium","portability":"medium to high"}},{"id":"meg-neurofeedback","type":"modality","attributes":{"name":"MEG Neurofeedback","description":"Feedback based on magnetoencephalography, measuring magnetic fields produced by electrical activity in the brain.","discovery_year":1998,"signal_type":"magnetic","measurement_location":"whole head","temporal_resolution":"milliseconds","spatial_resolution":"centimeters","cost_effectiveness":"very low","portability":"very low"}},{"id":"smr-training","type":"protocol","attributes":{"name":"SMR Training","description":"Sensorimotor rhythm training, typically enhancing 12-15 Hz activity over sensorimotor cortex.","target_frequency":"12-15 Hz","typical_locations":["C3","C4","Cz"],"typical_applications":["ADHD","Epilepsy","Sleep disorders"],"development_year":1972,"evidence_level":"high"}},{"id":"alpha-training","type":"protocol","attributes":{"name":"Alpha Training","description":"Enhancement of alpha rhythms (8-12 Hz), promoting relaxation and stress reduction.","target_frequency":"8-12 Hz","typical_locations":["O1","O2","P3","P4"],"typical_applications":["Anxiety","Stress","Creativity enhancement"],"development_year":1968,"evidence_level":"medium"}},{"id":"theta-training","type":"protocol","attributes":{"name":"Theta Training","description":"Training focused on theta waves (4-8 Hz), often used for deep relaxation and memory enhancement.","target_frequency":"4-8 Hz","typical_locations":["Fz","Pz"],"typical_applications":["Memory enhancement","Deep relaxation","Trauma treatment"],"development_year":1975,"evidence_level":"medium"}},{"id":"beta-training","type":"protocol","attributes":{"name":"Beta Training","description":"Enhancement of beta activity (15-20 Hz), promoting focus and attention.","target_frequency":"15-20 Hz","typical_locations":["F3","F4","Fz"],"typical_applications":["ADHD","Cognitive enhancement","Performance optimization"],"development_year":1976,"evidence_level":"high"}},{"id":"alpha-theta-training","type":"protocol","attributes":{"name":"Alpha-Theta Training","description":"Training that promotes transitions between alpha and theta states, used for trauma, addiction and PTSD treatment.","target_frequency":"4-12 Hz","typical_locations":["Pz","Oz"],"typical_applications":["PTSD","Addiction","Trauma recovery","Peak performance"],"development_year":1989,"evidence_level":"medium"}},{"id":"infra-low-frequency","type":"protocol","attributes":{"name":"Infra-Low Frequency Training","description":"Training of very slow brain oscillations below 0.5 Hz.","target_frequency":"<0.5 Hz","typical_locations":["T3","T4","Fp1","Fp2"],"typical_applications":["Complex trauma","Mood disorders","Migraine"],"development_year":2006,"evidence_level":"medium"}},{"id":"adhd-treatment","type":"clinical_application","attributes":{"name":"ADHD Treatment","description":"Application of neurofeedback for attention deficit hyperactivity disorder.","target_symptoms":["Inattention","Hyperactivity","Impulsivity"],"typical_protocols":["smr-training","beta-training","theta-beta-ratio"],"efficacy_rating":"Level 5 - Efficacious and Specific","research_volume":"high","typical_session_count":"30-40"}},{"id":"anxiety-treatment","type":"clinical_application","attributes":{"name":"Anxiety Treatment","description":"Application of neurofeedback for anxiety disorders.","target_symptoms":["Excessive worry","Physiological arousal","Avoidance behavior"],"typical_protocols":["alpha-training","alpha-theta-training"],"efficacy_rating":"Level 4 - Efficacious","research_volume":"medium","typical_session_count":"20-30"}},{"id":"epilepsy-treatment","type":"clinical_application","attributes":{"name":"Epilepsy Treatment","description":"Application of neurofeedback for seizure reduction in epilepsy.","target_symptoms":["Seizure frequency","Seizure intensity"],"typical_protocols":["smr-training","slow-cortical-potentials"],"efficacy_rating":"Level 4 - Efficacious","research_volume":"medium","typical_session_count":"30-40"}},{"id":"insomnia-treatment","type":"clinical_application","attributes":{"name":"Insomnia Treatment","description":"Application of neurofeedback for sleep disorders.","target_symptoms":["Sleep onset latency","Sleep maintenance","Sleep quality"],"typical_protocols":["smr-training","z-score-training"],"efficacy_rating":"Level 3 - Probably Efficacious","research_volume":"low","typical_session_count":"20-30"}},{"id":"ptsd-treatment","type":"clinical_application","attributes":{"name":"PTSD Treatment","description":"Application of neurofeedback for post-traumatic stress disorder.","target_symptoms":["Intrusive memories","Hyperarousal","Emotional dysregulation"],"typical_protocols":["alpha-theta-training","infra-low-frequency"],"efficacy_rating":"Level 3 - Probably Efficacious","research_volume":"medium","typical_session_count":"30-50"}},{"id":"sterman-mb","type":"researcher","attributes":{"name":"M. Barry Sterman","description":"Pioneer of SMR neurofeedback training, first demonstrated efficacy in treating epilepsy.","affiliation":"University of California, Los Angeles","key_contributions":["Discovery of SMR","EEG biofeedback for epilepsy","Sleep research"],"active_years":"1967-2010","key_publications":["Sterman, M. B., & Friar, L. (1972). Suppression of seizures in an epileptic following sensorimotor EEG feedback training.","Sterman, M. B. (2000). Basic concepts and clinical findings in the treatment of seizure disorders with EEG operant conditioning."]}},{"id":"lubar-jf","type":"researcher","attributes":{"name":"Joel F. Lubar","description":"Pioneer in applying neurofeedback to ADHD treatment.","affiliation":"University of Tennessee","key_contributions":["ADHD neurofeedback protocols","Theta/Beta ratio","Quantitative EEG assessment"],"active_years":"1976-2010","key_publications":["Lubar, J. F., & Shouse, M. N. (1976). EEG and behavioral changes in a hyperkinetic child concurrent with training of the sensorimotor rhythm (SMR).","Lubar, J. F. (1991). Discourse on the development of EEG diagnostics and biofeedback for attention-deficit/hyperactivity disorders."]}},{"id":"peniston-eg","type":"researcher","attributes":{"name":"Eugene G. Peniston","description":"Developer of the Peniston Protocol (alpha-theta training) for alcoholism and PTSD.","affiliation":"Veterans Administration Hospital, Fort Lyon","key_contributions":["Alpha-Theta protocol","PTSD treatment","Substance abuse applications"],"active_years":"1989-2005","key_publications":["Peniston, E. G., & Kulkosky, P. J. (1989). Alpha-theta brainwave training and beta-endorphin levels in alcoholics.","Peniston, E. G., & Kulkosky, P. J. (1991). Alpha-theta brainwave neurofeedback for Vietnam veterans with combat-related post-traumatic stress disorder."]}},{"id":"othmer-sf","type":"researcher","attributes":{"name":"Siegfried Othmer","description":"Developer of infra-low frequency neurofeedback and clinical researcher.","affiliation":"EEG Institute","key_contributions":["Infra-low frequency training","Clinical applications across disorders","Neurofeedback technology development"],"active_years":"1985-present","key_publications":["Othmer, S., Othmer, S. F., & Kaiser, D. A. (1999). EEG biofeedback: An emerging model for its global efficacy.","Othmer, S., & Othmer, S. F. (2009). Post traumatic stress disorder—The neurofeedback remedy."]}},{"id":"eeg-amplifier","type":"equipment","attributes":{"name":"EEG Amplifier","description":"Device for amplifying and digitizing EEG signals from electrodes.","types":["Research grade","Clinical grade","Consumer grade"],"key_specifications":["Number of channels","Sampling rate","Resolution","Noise level"],"typical_cost_range":"$500 - $50,000","development_trends":"Increasingly wireless, mobile, and user-friendly"}},{"id":"eeg-cap","type":"equipment","attributes":{"name":"EEG Cap/Headset","description":"Wearable cap or headset containing electrodes for EEG recording.","types":["Wet electrode caps","Dry electrode headsets","Hybrid systems"],"key_specifications":["Number of electrodes","Electrode material","Comfort","Setup time"],"typical_cost_range":"$200 - $5,000","development_trends":"Dry electrode technology, faster setup, increased comfort"}},{"id":"nf-software","type":"equipment","attributes":{"name":"Neurofeedback Software","description":"Software for signal processing, feedback generation, and session management.","types":["Clinical systems","Research platforms","Consumer applications"],"key_specifications":["Signal processing capabilities","Protocol flexibility","Data management","User interface"],"typical_cost_range":"$0 (open-source) - $15,000","development_trends":"Cloud integration, AI-assisted protocol selection, improved visualizations"}},{"id":"sterman-epilepsy-1972","type":"research_study","attributes":{"title":"Suppression of seizures in an epileptic following sensorimotor EEG feedback training","authors":["sterman-mb","Friar, L."],"year":1972,"journal":"Electroencephalography and Clinical Neurophysiology","key_findings":["First demonstration of SMR training reducing seizure frequency","Established foundation for neurofeedback in epilepsy treatment"],"methodology":"Single case design with a female subject with epilepsy","citation_count":476,"study_type":"clinical case study"}},{"id":"lubar-adhd-1976","type":"research_study","attributes":{"title":"EEG and behavioral changes in a hyperkinetic child concurrent with training of the sensorimotor rhythm (SMR)","authors":["lubar-jf","Shouse, M.N."],"year":1976,"journal":"Biofeedback and Self-regulation","key_findings":["First application of SMR training to ADHD symptoms","Demonstrated reduction in hyperactivity","Showed reversal of effects when training was reversed"],"methodology":"ABA reversal design with a single hyperkinetic child","citation_count":543,"study_type":"clinical case study"}},{"id":"peniston-alcoholism-1989","type":"research_study","attributes":{"title":"Alpha-theta brainwave training and beta-endorphin levels in alcoholics","authors":["peniston-eg","Kulkosky, P.J."],"year":1989,"journal":"Alcoholism: Clinical and Experimental Research","key_findings":["Alpha-theta training reduced depression and anxiety in alcoholics","Observed significant increases in beta-endorphin levels","Demonstrated 13-month abstinence in treatment group"],"methodology":"Controlled study with alcoholic participants","citation_count":312,"study_type":"controlled clinical trial"}},{"id":"arns-tdcs-2012","type":"research_study","attributes":{"title":"Neurophysiological predictors of non-response to rTMS in depression","authors":["Arns, M.","Several others"],"year":2012,"journal":"Journal of Affective Disorders","key_findings":["EEG alpha asymmetry predicted response to rTMS treatment","Integration of neurofeedback with other neuromodulation techniques","Personalized treatment approaches based on QEEG"],"methodology":"Retrospective analysis of treatment outcomes","citation_count":227,"study_type":"retrospective analysis"}},{"id":"operant-conditioning","type":"theoretical_framework","attributes":{"name":"Operant Conditioning","description":"Learning framework where behavior is modified by consequences, applied to brain activity in neurofeedback.","key_concepts":["Reinforcement","Instrumental learning","Behavior shaping"],"originators":["B.F. Skinner"],"relevance":"Provides core theoretical foundation for neurofeedback as a learning process"}},{"id":"neuroplasticity","type":"theoretical_framework","attributes":{"name":"Neuroplasticity","description":"Brain's ability to reorganize itself by forming new neural connections, the basis for long-term neurofeedback effects.","key_concepts":["Hebbian learning","Synaptic plasticity","Neural reorganization"],"originators":["Donald Hebb","Michael Merzenich"],"relevance":"Explains the lasting changes in brain function that result from neurofeedback training"}},{"id":"arousal-model","type":"theoretical_framework","attributes":{"name":"Arousal Model of Neurofeedback","description":"Framework explaining neurofeedback effects through optimizing cortical arousal levels.","key_concepts":["Optimal arousal","Over/under-arousal","Performance optimization"],"originators":["Karl Pribram","Barry Sterman"],"relevance":"Particularly relevant for ADHD, anxiety, and performance applications"}}],
            relationships: [{"source":"eeg-neurofeedback","target":"smr-training","type":"implements","attributes":{"strength":"high","description":"EEG neurofeedback is the primary modality for implementing SMR training"}},{"source":"eeg-neurofeedback","target":"alpha-training","type":"implements","attributes":{"strength":"high","description":"EEG neurofeedback is the primary modality for implementing alpha training"}},{"source":"eeg-neurofeedback","target":"beta-training","type":"implements","attributes":{"strength":"high","description":"EEG neurofeedback is the primary modality for implementing beta training"}},{"source":"eeg-neurofeedback","target":"theta-training","type":"implements","attributes":{"strength":"high","description":"EEG neurofeedback is the primary modality for implementing theta training"}},{"source":"eeg-neurofeedback","target":"infra-low-frequency","type":"implements","attributes":{"strength":"high","description":"EEG neurofeedback is used for implementing infra-low frequency training"}},{"source":"fmri-neurofeedback","target":"alpha-training","type":"implements","attributes":{"strength":"low","description":"fMRI can be used for alpha state training, but less commonly than EEG"}},{"source":"smr-training","target":"adhd-treatment","type":"used_for","attributes":{"strength":"high","description":"SMR training is commonly used for ADHD treatment","evidence_level":"high"}},{"source":"smr-training","target":"epilepsy-treatment","type":"used_for","attributes":{"strength":"high","description":"SMR training was originally developed for and is still used in epilepsy treatment","evidence_level":"medium"}},{"source":"alpha-training","target":"anxiety-treatment","type":"used_for","attributes":{"strength":"high","description":"Alpha training is frequently used for anxiety treatment","evidence_level":"medium"}},{"source":"beta-training","target":"adhd-treatment","type":"used_for","attributes":{"strength":"high","description":"Beta training is commonly used for ADHD treatment","evidence_level":"high"}},{"source":"alpha-theta-training","target":"ptsd-treatment","type":"used_for","attributes":{"strength":"high","description":"Alpha-theta training is a core protocol for PTSD treatment","evidence_level":"medium"}},{"source":"infra-low-frequency","target":"ptsd-treatment","type":"used_for","attributes":{"strength":"medium","description":"Infra-low frequency training is increasingly used for complex trauma and PTSD","evidence_level":"emerging"}},{"source":"sterman-mb","target":"smr-training","type":"developed","attributes":{"year":1972,"description":"Sterman developed SMR training through his work with cats and later humans with epilepsy"}},{"source":"sterman-mb","target":"sterman-epilepsy-1972","type":"conducted","attributes":{"role":"Principal Investigator","description":"Sterman led this groundbreaking study on neurofeedback for epilepsy"}},{"source":"lubar-jf","target":"beta-training","type":"developed","attributes":{"year":1976,"description":"Lubar pioneered the application of beta training protocols for ADHD"}},{"source":"lubar-jf","target":"lubar-adhd-1976","type":"conducted","attributes":{"role":"Principal Investigator","description":"Lubar conducted this seminal study applying neurofeedback to ADHD"}},{"source":"peniston-eg","target":"alpha-theta-training","type":"developed","attributes":{"year":1989,"description":"Peniston developed the alpha-theta protocol for alcoholism and PTSD"}},{"source":"peniston-eg","target":"peniston-alcoholism-1989","type":"conducted","attributes":{"role":"Principal Investigator","description":"Peniston led this influential study on alpha-theta training for alcoholism"}},{"source":"othmer-sf","target":"infra-low-frequency","type":"developed","attributes":{"year":2006,"description":"Othmer pioneered infra-low frequency training for various clinical applications"}},{"source":"eeg-amplifier","target":"eeg-neurofeedback","type":"enables","attributes":{"description":"EEG amplifiers are essential hardware components for EEG neurofeedback"}},{"source":"eeg-cap","target":"eeg-neurofeedback","type":"enables","attributes":{"description":"EEG caps/headsets are required to collect brain signals for neurofeedback"}},{"source":"nf-software","target":"smr-training","type":"implements","attributes":{"description":"Neurofeedback software provides the algorithmic implementation of SMR training protocols"}},{"source":"nf-software","target":"alpha-training","type":"implements","attributes":{"description":"Neurofeedback software provides the algorithmic implementation of alpha training protocols"}},{"source":"operant-conditioning","target":"smr-training","type":"explains","attributes":{"description":"Operant conditioning provides the theoretical basis for how SMR training works"}},{"source":"neuroplasticity","target":"eeg-neurofeedback","type":"explains","attributes":{"description":"Neuroplasticity explains the long-term brain changes that result from neurofeedback training"}},{"source":"arousal-model","target":"adhd-treatment","type":"explains","attributes":{"description":"The arousal model helps explain why neurofeedback is effective for ADHD"}}]
        };
        
        // Color scale for different node types
        const colorScale = d3.scaleOrdinal(d3.schemeCategory10);
        
        // Set up the SVG
        const margin = { top: 20, right: 20, bottom: 20, left: 20 };
        const width = 800 - margin.left - margin.right;
        const height = 600 - margin.top - margin.bottom;
        
        const svg = d3.select('#graph')
            .append('svg')
            .attr('width', '100%')
            .attr('height', '100%')
            .attr('viewBox', [0, 0, width, height])
            .attr('preserveAspectRatio', 'xMidYMid meet')
            .append('g')
            .attr('transform', 'translate(' + margin.left + ',' + margin.top + ')');
            
        // Add zoom behavior
        const zoom = d3.zoom()
            .scaleExtent([0.1, 4])
            .on('zoom', (event) => {
                container.attr('transform', event.transform);
            });
            
        svg.call(zoom);
        
        // Create container for the graph
        const container = svg.append('g');
        
        // Create arrow marker for directed edges
        svg.append('defs').append('marker')
            .attr('id', 'arrowhead')
            .attr('viewBox', '-5 -5 10 10')
            .attr('refX', 15)
            .attr('refY', 0)
            .attr('markerWidth', 6)
            .attr('markerHeight', 6)
            .attr('orient', 'auto')
            .append('path')
            .attr('d', 'M -5,-5 L 5,0 L -5,5')
            .attr('fill', '#999');
            
        // Create the links
        const links = container.append('g')
            .selectAll('line')
            .data(data.relationships)
            .enter()
            .append('line')
            .attr('stroke', '#999')
            .attr('stroke-width', 1)
            .attr('marker-end', 'url(#arrowhead)')
            .attr('stroke-opacity', 0.6);
            
        // Create the nodes
        const nodes = container.append('g')
            .selectAll('g')
            .data(data.entities)
            .enter()
            .append('g')
            .attr('class', 'node')
            .call(d3.drag()
                .on('start', dragstarted)
                .on('drag', dragged)
                .on('end', dragended));
                
        // Add circles for nodes
        nodes.append('circle')
            .attr('r', 8)
            .attr('fill', d => colorScale(d.type))
            .attr('stroke', '#fff')
            .attr('stroke-width', 2);
            
        // Add labels to nodes
        nodes.append('text')
            .attr('dx', 12)
            .attr('dy', '.35em')
            .text(d => d.attributes.name || d.attributes.title || d.id)
            .attr('font-size', '12px')
            .attr('fill', '#333');
            
        // Set up the simulation
        const simulation = d3.forceSimulation()
            .force('link', d3.forceLink().id(d => d.id).distance(100))
            .force('charge', d3.forceManyBody().strength(-200))
            .force('center', d3.forceCenter(width / 2, height / 2))
            .force('collision', d3.forceCollide().radius(30));
            
        // Update the simulation
        simulation
            .nodes(data.entities)
            .on('tick', ticked);
            
        simulation.force('link')
            .links(data.relationships);
            
        // Create the legend
        const types = [...new Set(data.entities.map(d => d.type))];
        const legend = d3.select('.legend')
            .append('div')
            .attr('class', 'legend-items');
            
        legend.selectAll('.legend-item')
            .data(types)
            .enter()
            .append('div')
            .attr('class', 'legend-item')
            .html(d => '<span class="legend-color" style="background-color: ' + colorScale(d) + '"></span><span class="legend-label">' + d + '</span>');
            
        // Populate type filter
        const typeFilter = document.getElementById('typeFilter');
        types.forEach(type => {
            const option = document.createElement('option');
            option.value = type;
            option.textContent = type;
            typeFilter.appendChild(option);
        });
        
        // Add event listeners
        typeFilter.addEventListener('change', filterNodes);
        document.getElementById('searchInput').addEventListener('input', filterNodes);
        const clearFiltersBtn = document.getElementById('clear-filters');
        clearFiltersBtn.addEventListener('click', clearFilters);
        
        // Get all type filter checkboxes
        const typeFilters = document.querySelector('.filters');
        Array.from(typeFilters.querySelectorAll('input')).forEach(input => {
            input.checked = true;
        });
        
        // Zoom controls
        const zoomInBtn = document.getElementById('zoom-in');
        const zoomOutBtn = document.getElementById('zoom-out');
        const zoomResetBtn = document.getElementById('zoom-reset');
        
        zoomInBtn.addEventListener('click', () => {
            svg.transition().duration(300).call(zoom.scaleBy, 1.3);
        });
        
        zoomOutBtn.addEventListener('click', () => {
            svg.transition().duration(300).call(zoom.scaleBy, 0.7);
        });
        
        zoomResetBtn.addEventListener('click', () => {
            svg.transition().duration(500).call(zoom.transform, d3.zoomIdentity);
        });
        
        // Interactive entity selection
        window.selectEntityById = (id) => {
            const selectedNode = data.entities.find(d => d.id === id);
            if (selectedNode) {
                // Highlight the node
                highlightNode(selectedNode);
                
                // Center the view on the node
                const scale = 1.5;
                const x = width / 2 - scale * selectedNode.x;
                const y = height / 2 - scale * selectedNode.y;
                svg.transition().duration(500)
                   .call(zoom.transform, d3.zoomIdentity.translate(x, y).scale(scale));
                
                // Show node details
                showNodeDetails(selectedNode);
            }
        };
        
        // Node click handler
        nodes.on('click', (event, d) => {
            showNodeDetails(d);
            // Navigate to entity page
            window.location.href = d.id + '.html';
        });
        
        // Example of interactive relationship navigation
        // href="javascript:void(0)" onclick="selectEntityById
        
        // Hover effects
        nodes
            .on('mouseover', highlightConnections)
            .on('mouseout', resetHighlight);
            
        // Functions
        function ticked() {
            links
                .attr('x1', d => d.source.x)
                .attr('y1', d => d.source.y)
                .attr('x2', d => d.target.x)
                .attr('y2', d => d.target.y);
                
            nodes.attr('transform', d => 'translate(' + d.x + ',' + d.y + ')');
        }
        
        function dragstarted(event) {
            if (!event.active) simulation.alphaTarget(0.3).restart();
            event.subject.fx = event.subject.x;
            event.subject.fy = event.subject.y;
        }
        
        function dragged(event) {
            event.subject.fx = event.x;
            event.subject.fy = event.y;
        }
        
        function dragended(event) {
            if (!event.active) simulation.alphaTarget(0);
            event.subject.fx = null;
            event.subject.fy = null;
        }
        
        function showNodeDetails(node) {
            const details = document.getElementById('nodeDetails');
            let html = '<h3>' + (node.attributes.name || node.attributes.title || node.id) + '</h3>' +
                      '<p><strong>Type:</strong> ' + node.type + '</p>';
            
            for (const [key, value] of Object.entries(node.attributes)) {
                if (key !== 'name' && key !== 'title' && typeof value !== 'object') {
                    html += '<p><strong>' + key + ':</strong> ' + value + '</p>';
                }
            }
            
            details.innerHTML = html;
        }
        
        function highlightConnections(event, d) {
            // Reduce opacity of all elements
            nodes.style('opacity', 0.2);
            links.style('opacity', 0.1);
            
            // Highlight connected nodes and links
            const connectedNodes = new Set();
            links.each(l => {
                if (l.source === d || l.target === d) {
                    connectedNodes.add(l.source.id);
                    connectedNodes.add(l.target.id);
                }
            });
            
            nodes.filter(n => connectedNodes.has(n.id))
                .style('opacity', 1);
                
            links.filter(l => l.source === d || l.target === d)
                .style('opacity', 1)
                .style('stroke-width', 2);
                
            // Show the current node
            d3.select(event.currentTarget).style('opacity', 1);
        }
        
        function highlightNode(node) {
            // Reset all nodes and links
            resetHighlight();
            
            // Find the DOM element for this node
            const nodeElement = nodes.filter(d => d.id === node.id);
            
            // Highlight it
            nodeElement.select('circle')
                .attr('r', 12)
                .attr('stroke', '#ff6600')
                .attr('stroke-width', 3);
        }
        
        function resetHighlight() {
            nodes.style('opacity', 1);
            links.style('opacity', 0.6)
                .style('stroke-width', 1);
                
            nodes.select('circle')
                .attr('r', 8)
                .attr('stroke', '#fff')
                .attr('stroke-width', 2);
        }
        
        function filterNodes() {
            const selectedType = typeFilter.value;
            const searchText = document.getElementById('searchInput').value.toLowerCase();
            
            nodes.style('display', d => {
                const matchesType = selectedType === 'all' || d.type === selectedType;
                const matchesSearch = !searchText || 
                    d.id.toLowerCase().includes(searchText) || 
                    (d.attributes.name && d.attributes.name.toLowerCase().includes(searchText)) ||
                    (d.attributes.title && d.attributes.title.toLowerCase().includes(searchText));
                return matchesType && matchesSearch ? null : 'none';
            });
            
            links.style('display', d => {
                const sourceVisible = selectedType === 'all' || d.source.type === selectedType;
                const targetVisible = selectedType === 'all' || d.target.type === selectedType;
                return sourceVisible && targetVisible ? null : 'none';
            });
        }
        
        function clearFilters() {
            typeFilter.value = 'all';
            document.getElementById('searchInput').value = '';
            filterNodes();
        }
    </script>
</body>
</html>